# 块加密（分组加密）

> 文章参考：
>
> - [块加密 工作模式 ECB、CBC、PCBC、CFB、OFB、CTR](https://blog.csdn.net/jerry81333/article/details/78336616)
> - [干货学习——密码学之块加密](https://baijiahao.baidu.com/s?id=1651159916892970446&wfr=spider&for=pc)
> - [密码学](https://www.dazhuanlan.com/2020/03/29/5e80bb0c84525/)
> - [CFB模式解读](https://blog.csdn.net/chengqiuming/article/details/82355772)
> - [密码学常用的算法填充模式_密码学的操作模式](https://blog.csdn.net/cumt951045/article/details/107793006)

## 块加密简单介绍

**块加密，又称分组加密：**是一种常见的**对称加密**。块加密的工作模式允许使用同一个分组密码密钥对多于一块的数据进行加密，并保证其安全性。

**基本原理：**它将固定长度的数据块或纯文本数据（未加密）转换成长度相同的密码块（加密文本）数据。该转换的前提是用户提供密钥。解密时，要使用相同的密钥对密码块数据进行逆转换。固定的长度被称做数据块大小，大多数密码块的固定大小都是64位或128位。

**常见的加密法：**DES和3DES是使用最多的数据块加密，AES是更高级的块加密法等等 





## 1、ECB模式-电子编码薄

ECB模式是最简单的块密码加密模式，加密前根据加密块大小（如AES为128位）分成若干块，之后将每块使用相同的密钥单独加密，解密同理。

当我们拿去加密**bmp文件(位图)**时，常不能很好的隐藏数据模式，例如我们去加密后得到右图，任然可以看到基本图片形状。

![img](https://img-blog.csdn.net/20171025034453591?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvamVycnk4MTMzMw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)

例题：[ecb,_it’s_easy_as_123](https://www.cnblogs.com/coming1890/p/13509255.html)



## 2、CBC模式-密码块链接

每个明文块先与前一个密文块进行异或后，再进行加密。在这种方法中，每个密文块都依赖于它前面的所有明文块。同时，为了保证每条消息的唯一性，在第一个块中需要使用初始化向量IV。相比ECB模式破解难度也更高。

该加密模式的缺点是不能实时解密，也就是说，必须等到每个块都接收到之后才能开始加密，否则就不能得到正确的结果。所以，CBC模式不适合在要求实时性比较高的环境下使用。



## 3、PCBC-填充密码块链接

填充密码块链接，或称为明文密码块链接。和CBC大部分一样，但是加密时，把明文和密文都异或进来，是一种尝试防止CBC翻转攻击策略，缺陷速度特别慢，每一个块解密，明文和密文相互依赖，无法并行加解密



## 4、CFB-密文反馈

在CFB模式中，前一个密文分组会被送回到密码算法的输入端。所谓反馈，这里指的就是返回输入端的意思。

**CFB模式与ECB和CBC模式只能够加密块数据不同**，可以将块密码变为自同步的流密码；CFB的解密过程几乎就是颠倒的CBC的加密过程。即在ECB模式和CBC模式中，明文分组都是通过密码算法进行加密的，然而，在CFB模式中，明文分组并没有通过密码算法来直接进行加密。

![img](https://img-blog.csdn.net/20180903220102338?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NoZW5ncWl1bWluZw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)

CBC模式和CFB模式比较：![img](https://img-blog.csdn.net/20180903220139811?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NoZW5ncWl1bWluZw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)



CFB的加密工作分为两部分：

1. 将一前段加密得到的密文再加密；
2. 将第1步加密得到的数据与当前段的明文异或；



## 5、OFB-输出反馈

**加密过程：**OFB是先用块加密器生成密钥流（Keystream），然后再将密钥流与明文流异或得到密文流，类似于CFB-密文反馈

**解密过程：**先用块加密器生成密钥流，再将密钥流与密文流异或得到明文，由于异或操作的对称性所以加密和解密的流程是完全一样的



## 6、CTR-计数器模式

CTR模式也被称为ICM模式（Integer Counter Mode，整数计数模式）和SIC模式（Segmented Integer Counter），与OFB相似，CTR将块密码变为流密码。它通过递增一个加密计数器以产生连续的密钥流，其中，计数器可以是任意保证长时间不产生重复输出的函数，但使用一个普通的计数器是最简单和最常见的做法。

CTR模式的特征类似于OFB，但它允许在解密时进行随机存取。由于加密和解密过程均可以进行并行处理，CTR适合运用于多处理器的硬件上。